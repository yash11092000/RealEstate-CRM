@* @model PhysioWeb.Models.Customer *@
@{
    ViewBag.Title = "Customer Management";
    var theme = User.FindFirst("Theme")?.Value ?? "#198754";
}

<style>
    :root {
        --theme-color: @theme;
        --sidebar-width: 280px;
        --sidebar-collapsed-width: 70px;
        --transition-speed: 0.3s;
        --primary-color: @theme;
        --secondary-color: #6c757d;
        --light-bg: #f8f9fa;
    }

    .card-title i {
        color: var(--theme-color);
    }

    .nav-tabs .nav-link.active {
        background: var(--theme-color);
        color: #fff !important;
    }

    .btn-theme {
        background-color: var(--theme-color);
        border-color: var(--theme-color);
        color: white;
    }

        .btn-theme:hover {
            background-color: #166f46;
            border-color: #166f46;
        }

    .nav-tabs .nav-link {
        color: var(--theme-color);
        font-weight: 600;
        border: 2px solid transparent;
        border-radius: 0.5rem 0.5rem 0 0;
        transition: all 0.3s ease-in-out;
    }

        .nav-tabs .nav-link:hover {
            background: #e6f4ea;
            border-color: var(--theme-color);
            color: var(--theme-color);
        }

        .nav-tabs .nav-link.active {
            background: var(--theme-color);
            color: white !important;
            border-color: var(--theme-color);
        }

    .status-badge {
        padding: 0.5em 1em;
        border-radius: 20px;
        font-weight: 600;
    }

    .badge-active {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .badge-inactive {
        background-color: #e2e3e5;
        color: #383d41;
        border: 1px solid #d6d8db;
    }

    .badge-closed {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .section-divider {
        border-bottom: 2px solid var(--theme-color);
        margin: 2rem 0;
        opacity: 0.3;
    }
</style>

<main class="dashboard-content with-sidebar collapsed">
    <div class="container-fluid mt-4">
        <ul class="nav nav-tabs" id="customerTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="new-customer-tab" data-bs-toggle="tab"
                        data-bs-target="#new-customer" type="button" role="tab">
                    <i class="bi bi-person-plus"></i> New Customer
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="all-customers-tab" data-bs-toggle="tab"
                        data-bs-target="#all-customers" type="button" role="tab">
                    <i class="bi bi-people"></i> All Customers
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-4" id="customerTabsContent">
            <!-- New Customer Tab -->
            <div class="tab-pane fade show active" id="new-customer" role="tabpanel">
                <form asp-action="CreateCustomer" method="post" id="customerForm">

                    <!-- 1️⃣ Basic Information -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-person-vcard"></i> Basic Information</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Customer ID</label>
                                <input class="form-control" value="CUST-@DateTime.Now.ToString("yyyyMMdd")-001" readonly />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Lead ID</label>
                                <select class="form-select">
                                    <option value="">-- Select Lead --</option>
                                    <option>LEAD001 - Michael Scott</option>
                                    <option>LEAD002 - Pam Beesly</option>
                                    <option>LEAD003 - Jim Halpert</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Converted Date</label>
                                <input type="date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Customer Type</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Type --</option>
                                    <option value="buyer">Buyer</option>
                                    <option value="seller">Seller</option>
                                    <option value="tenant">Tenant</option>
                                    <option value="owner">Owner</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" placeholder="Enter full name" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" placeholder="Enter email address" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Phone Number *</label>
                                <input type="text" class="form-control" placeholder="Enter phone number" required />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Alternate Number</label>
                                <input type="text" class="form-control" placeholder="Optional" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Gender</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Preferred Contact</label>
                                <select class="form-select">
                                    <option value="call">Call</option>
                                    <option value="whatsapp">WhatsApp</option>
                                    <option value="email">Email</option>
                                </select>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" rows="3" placeholder="Enter complete address"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" placeholder="Enter city" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">State</label>
                                <input type="text" class="form-control" placeholder="Enter state" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-control" placeholder="Enter pincode" />
                            </div>
                        </div>
                    </div>

                    <!-- 🏠 2️⃣ Property / Requirement Details -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-house-door"></i> Property & Requirement Details</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Requirement Type</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="buy">Buy</option>
                                    <option value="sell">Sell</option>
                                    <option value="rent">Rent</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Property Type</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="apartment">Apartment</option>
                                    <option value="villa">Villa</option>
                                    <option value="plot">Plot</option>
                                    <option value="shop">Shop</option>
                                    <option value="commercial">Commercial</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Property Category</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="residential">Residential</option>
                                    <option value="commercial">Commercial</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">BHK / Configuration</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="1bhk">1 BHK</option>
                                    <option value="2bhk">2 BHK</option>
                                    <option value="3bhk">3 BHK</option>
                                    <option value="4bhk">4 BHK</option>
                                    <option value="studio">Studio</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Property ID</label>
                                <select class="form-select">
                                    <option value="">-- Select Property --</option>
                                    <option>PROP001 - Ocean View Apartment</option>
                                    <option>PROP002 - Downtown Office</option>
                                    <option>PROP003 - Garden Villa</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Budget / Deal Value (₹)</label>
                                <input type="number" step="0.01" class="form-control" placeholder="Enter amount" />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Furnishing Type</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="furnished">Furnished</option>
                                    <option value="semi">Semi-Furnished</option>
                                    <option value="unfurnished">Unfurnished</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Location / Area</label>
                                <input type="text" class="form-control" placeholder="Preferred or purchased area" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Possession Date</label>
                                <input type="date" class="form-control" />
                            </div>
                        </div>
                    </div>

                    <!-- 💰 3️⃣ Financial Details -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-currency-rupee"></i> Financial Details</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Booking Amount (₹)</label>
                                <input type="number" step="0.01" class="form-control" placeholder="Token amount" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Total Deal Amount (₹)</label>
                                <input type="number" step="0.01" class="form-control" placeholder="Final amount" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select">
                                    <option value="pending">Pending</option>
                                    <option value="partial">Partial</option>
                                    <option value="full">Full</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Payment Mode</label>
                                <select class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="cash">Cash</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="upi">UPI</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Payment Schedule ID</label>
                                <select class="form-select">
                                    <option value="">-- Select Schedule --</option>
                                    <option>SCH001 - Standard Payment Plan</option>
                                    <option>SCH002 - Custom Payment Plan</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Invoice / Agreement IDs</label>
                                <select class="form-select" multiple>
                                    <option>INV001 - Token Payment</option>
                                    <option>INV002 - Agreement Payment</option>
                                    <option>AG001 - Sale Agreement</option>
                                </select>
                                <small class="text-muted">Hold Ctrl to select multiple</small>
                            </div>
                        </div>
                    </div>

                    <!-- 👥 4️⃣ Relationship & Management -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-diagram-3"></i> Relationship & Management</h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Assigned Agent</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Agent --</option>
                                    <option>John Smith - Agent 1</option>
                                    <option>Sarah Lee - Agent 2</option>
                                    <option>Mike Johnson - Agent 3</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Lead Source</label>
                                <select class="form-select">
                                    <option value="">-- Select Source --</option>
                                    <option value="website">Website</option>
                                    <option value="referral">Referral</option>
                                    <option value="walkin">Walk-in</option>
                                    <option value="social_media">Social Media</option>
                                    <option value="campaign">Campaign</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" required>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Created By</label>
                                <input class="form-control" value="@User.Identity.Name" readonly />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Created Date</label>
                                <input class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm")" readonly />
                            </div>
                        </div>
                    </div>

                    <!-- 🗒️ 5️⃣ Communication & Notes -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-chat-left-text"></i> Communication & Notes</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Follow-up Date</label>
                                <input type="date" class="form-control" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Documents Upload</label>
                                <input type="file" class="form-control" multiple />
                                <small class="text-muted">Upload KYC, Agreement, PAN, etc.</small>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Remarks / Notes</label>
                                <textarea class="form-control" rows="4" placeholder="Add internal comments and notes..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <button type="reset" class="btn btn-secondary btn-lg">
                            <i class="bi bi-x-circle"></i> Reset
                        </button>
                        <button type="submit" class="btn btn-theme btn-lg">
                            <i class="bi bi-save"></i> Save Customer
                        </button>
                    </div>
                </form>
            </div>

            <!-- All Customers Tab -->
            <div class="tab-pane fade" id="all-customers" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="btn-group">
                        <button class="btn btn-outline-theme active">All Customers</button>
                        <button class="btn btn-outline-theme">Buyers</button>
                        <button class="btn btn-outline-theme">Sellers</button>
                        <button class="btn btn-outline-theme">Active</button>
                    </div>
                    <div class="input-group" style="width: 300px;">
                        <input type="text" class="form-control" placeholder="Search customers...">
                        <button class="btn btn-theme" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>

                <table class="table table-striped table-hover mt-3">
                    <thead class="table-primary">
                        <tr>
                            <th>Customer ID</th>
                            <th>Full Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Customer Type</th>
                            <th>Assigned Agent</th>
                            <th>Status</th>
                            <th>Created Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CUST-20241112-001</td>
                            <td>Michael Scott</td>
                            <td>+91 98765 43210</td>
                            <td>michael@dundermifflin.com</td>
                            <td>Buyer</td>
                            <td>John Smith</td>
                            <td><span class="status-badge badge-active">Active</span></td>
                            <td>2024-11-12</td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                        <tr>
                            <td>CUST-20241110-002</td>
                            <td>Pam Beesly</td>
                            <td>+91 87654 32109</td>
                            <td>pam@dundermifflin.com</td>
                            <td>Seller</td>
                            <td>Sarah Lee</td>
                            <td><span class="status-badge badge-active">Active</span></td>
                            <td>2024-11-10</td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                        <tr>
                            <td>CUST-20241108-003</td>
                            <td>Jim Halpert</td>
                            <td>+91 76543 21098</td>
                            <td>jim@dundermifflin.com</td>
                            <td>Tenant</td>
                            <td>Mike Johnson</td>
                            <td><span class="status-badge badge-closed">Closed</span></td>
                            <td>2024-11-08</td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Showing 1 to 3 of 45 total customers.</span>
                    <button class="btn btn-outline-secondary">Load More</button>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var triggerEl = document.querySelector('#customerTabs button[data-bs-target="#new-customer"]');
            if (triggerEl) {
                bootstrap.Tab.getInstance(triggerEl)?.show();
            }

            // Auto-fill customer data when lead is selected
            const leadData = {
                'LEAD001': {
                    name: 'Michael Scott',
                    email: 'michael@dundermifflin.com',
                    phone: '+91 98765 43210'
                },
                'LEAD002': {
                    name: 'Pam Beesly',
                    email: 'pam@dundermifflin.com',
                    phone: '+91 87654 32109'
                },
                'LEAD003': {
                    name: 'Jim Halpert',
                    email: 'jim@dundermifflin.com',
                    phone: '+91 76543 21098'
                }
            };

            document.querySelector('select[name="LeadId"]').addEventListener('change', function() {
                const leadId = this.value.split(' ')[0];
                const lead = leadData[leadId];
                if (lead) {
                    document.querySelector('input[name="FullName"]').value = lead.name;
                    document.querySelector('input[name="Email"]').value = lead.email;
                    document.querySelector('input[name="PhoneNumber"]').value = lead.phone;
                }
            });
        });
    </script>
}