@* @model PhysioWeb.Models.OrderConfirm *@
@{
    ViewBag.Title = "Booking Management";
    var theme = User.FindFirst("Theme")?.Value ?? "#198754";
}

<style>
    :root {
        --theme-color: @theme;
        --sidebar-width: 280px;
        --sidebar-collapsed-width: 70px;
        --transition-speed: 0.3s;
        --primary-color: @theme;
        --secondary-color: #6c757d;
        --light-bg: #f8f9fa;
    }

    .card-title i {
        color: var(--theme-color);
    }

    .nav-tabs .nav-link.active {
        background: var(--theme-color);
        color: #fff !important;
    }

    .btn-theme {
        background-color: var(--theme-color);
        border-color: var(--theme-color);
        color: white;
    }

        .btn-theme:hover {
            background-color: #166f46;
            border-color: #166f46;
        }

    .nav-tabs .nav-link {
        color: var(--theme-color);
        font-weight: 600;
        border: 2px solid transparent;
        border-radius: 0.5rem 0.5rem 0 0;
        transition: all 0.3s ease-in-out;
    }

        .nav-tabs .nav-link:hover {
            background: #e6f4ea;
            border-color: var(--theme-color);
            color: var(--theme-color);
        }

        .nav-tabs .nav-link.active {
            background: var(--theme-color);
            color: white !important;
            border-color: var(--theme-color);
        }

    .payment-status-badge {
        padding: 0.5em 1em;
        border-radius: 20px;
        font-weight: 600;
    }

    .badge-paid {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .badge-pending {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
</style>

<main class="dashboard-content with-sidebar collapsed">
    <div class="container-fluid mt-4">
        <ul class="nav nav-tabs" id="bookingTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="new-booking-tab" data-bs-toggle="tab"
                        data-bs-target="#new-booking" type="button" role="tab">
                    <i class="bi bi-file-earmark-plus"></i> New Booking
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="all-bookings-tab" data-bs-toggle="tab"
                        data-bs-target="#all-bookings" type="button" role="tab">
                    <i class="bi bi-list-ul"></i> All Bookings
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-4" id="bookingTabsContent">
            <!-- New Booking Tab -->
            <div class="tab-pane fade show active" id="new-booking" role="tabpanel">
                <form asp-action="CreateBooking" method="post" id="bookingForm">
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-info-circle-fill"></i> Booking Details</h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Booking ID</label>
                                <input class="form-control" value="BKG-@DateTime.Now.ToString("yyyyMMdd")-001" readonly />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Customer ID</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Customer --</option>
                                    <option>CUST001 - Michael Scott</option>
                                    <option>CUST002 - Pam Beesly</option>
                                    <option>CUST003 - Jim Halpert</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Property ID</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Property --</option>
                                    <option>PROP001 - Ocean View Apartment</option>
                                    <option>PROP002 - Downtown Office</option>
                                    <option>PROP003 - Garden Villa</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Booking Date</label>
                                <input type="date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Token Amount (₹)</label>
                                <input type="number" step="0.01" class="form-control" placeholder="Enter token amount" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Payment Mode</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Payment Mode --</option>
                                    <option value="cash">Cash</option>
                                    <option value="upi">UPI</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" required>
                                    <option value="">-- Select Status --</option>
                                    <option value="paid">Paid</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Remarks / Internal Notes</label>
                                <textarea class="form-control" rows="3" placeholder="Add internal notes or comments..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Customer & Property Summary Card -->
                    <div class="card p-3 mb-4 shadow-sm">
                        <h5 class="card-title"><i class="bi bi-person-badge"></i> Customer & Property Summary</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="border rounded p-3 bg-light">
                                    <h6 class="text-theme">Customer Information</h6>
                                    <div class="small">
                                        <div><strong>Name:</strong> <span id="customerName">-</span></div>
                                        <div><strong>Phone:</strong> <span id="customerPhone">-</span></div>
                                        <div><strong>Email:</strong> <span id="customerEmail">-</span></div>
                                        <div><strong>Address:</strong> <span id="customerAddress">-</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="border rounded p-3 bg-light">
                                    <h6 class="text-theme">Property Information</h6>
                                    <div class="small">
                                        <div><strong>Property:</strong> <span id="propertyName">-</span></div>
                                        <div><strong>Type:</strong> <span id="propertyType">-</span></div>
                                        <div><strong>Location:</strong> <span id="propertyLocation">-</span></div>
                                        <div><strong>Price:</strong> <span id="propertyPrice">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <button type="reset" class="btn btn-secondary btn-lg">
                            <i class="bi bi-x-circle"></i> Reset
                        </button>
                        <button type="submit" class="btn btn-theme btn-lg">
                            <i class="bi bi-check-circle"></i> Confirm Booking
                        </button>
                    </div>
                </form>
            </div>

            <!-- All Bookings Tab -->
            <div class="tab-pane fade" id="all-bookings" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="btn-group">
                        <button class="btn btn-outline-theme active">All Bookings</button>
                        <button class="btn btn-outline-theme">Paid</button>
                        <button class="btn btn-outline-theme">Pending</button>
                    </div>
                    <div class="input-group" style="width: 300px;">
                        <input type="text" class="form-control" placeholder="Search bookings...">
                        <button class="btn btn-theme" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>

                <table class="table table-striped table-hover mt-3">
                    <thead class="table-primary">
                        <tr>
                            <th>Booking ID</th>
                            <th>Customer</th>
                            <th>Property</th>
                            <th>Booking Date</th>
                            <th>Token Amount</th>
                            <th>Payment Mode</th>
                            <th>Payment Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>BKG-20241112-001</td>
                            <td>Michael Scott</td>
                            <td>Ocean View Apartment</td>
                            <td>2024-11-12</td>
                            <td>₹5,00,000</td>
                            <td>UPI</td>
                            <td><span class="payment-status-badge badge-paid">Paid</span></td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                        <tr>
                            <td>BKG-20241110-002</td>
                            <td>Pam Beesly</td>
                            <td>Downtown Office</td>
                            <td>2024-11-10</td>
                            <td>₹10,00,000</td>
                            <td>Cheque</td>
                            <td><span class="payment-status-badge badge-pending">Pending</span></td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                        <tr>
                            <td>BKG-20241108-003</td>
                            <td>Jim Halpert</td>
                            <td>Garden Villa</td>
                            <td>2024-11-08</td>
                            <td>₹7,50,000</td>
                            <td>Bank Transfer</td>
                            <td><span class="payment-status-badge badge-paid">Paid</span></td>
                            <td>
                                <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
                                <button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Showing 1 to 3 of 15 total bookings.</span>
                    <div class="btn-group">
                        <button class="btn btn-outline-theme btn-sm">Previous</button>
                        <button class="btn btn-outline-theme btn-sm active">1</button>
                        <button class="btn btn-outline-theme btn-sm">2</button>
                        <button class="btn btn-outline-theme btn-sm">3</button>
                        <button class="btn btn-outline-theme btn-sm">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var triggerEl = document.querySelector('#bookingTabs button[data-bs-target="#new-booking"]');
            if (triggerEl) {
                bootstrap.Tab.getInstance(triggerEl)?.show();
            }

            // Sample data for customer and property information
            const customerData = {
                'CUST001': {
                    name: 'Michael Scott',
                    phone: '+91 98765 43210',
                    email: 'michael@dundermifflin.com',
                    address: 'Scranton, PA'
                },
                'CUST002': {
                    name: 'Pam Beesly',
                    phone: '+91 87654 32109',
                    email: 'pam@dundermifflin.com',
                    address: 'Scranton, PA'
                },
                'CUST003': {
                    name: 'Jim Halpert',
                    phone: '+91 76543 21098',
                    email: 'jim@dundermifflin.com',
                    address: 'Scranton, PA'
                }
            };

            const propertyData = {
                'PROP001': {
                    name: 'Ocean View Apartment',
                    type: '3 BHK Apartment',
                    location: 'Marine Drive, Mumbai',
                    price: '₹2.5 Cr'
                },
                'PROP002': {
                    name: 'Downtown Office',
                    type: 'Commercial Office',
                    location: 'Bandra Kurla Complex, Mumbai',
                    price: '₹5 Cr'
                },
                'PROP003': {
                    name: 'Garden Villa',
                    type: 'Villa',
                    location: 'Pune',
                    price: '₹1.8 Cr'
                }
            };

            // Update customer information when selected
            document.querySelector('select[name="CustomerId"]').addEventListener('change', function() {
                const customerId = this.value.split(' ')[0];
                const customer = customerData[customerId];
                if (customer) {
                    document.getElementById('customerName').textContent = customer.name;
                    document.getElementById('customerPhone').textContent = customer.phone;
                    document.getElementById('customerEmail').textContent = customer.email;
                    document.getElementById('customerAddress').textContent = customer.address;
                }
            });

            // Update property information when selected
            document.querySelector('select[name="PropertyId"]').addEventListener('change', function() {
                const propertyId = this.value.split(' ')[0];
                const property = propertyData[propertyId];
                if (property) {
                    document.getElementById('propertyName').textContent = property.name;
                    document.getElementById('propertyType').textContent = property.type;
                    document.getElementById('propertyLocation').textContent = property.location;
                    document.getElementById('propertyPrice').textContent = property.price;
                }
            });
        });
    </script>
}