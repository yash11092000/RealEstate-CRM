@* @model PhysioWeb.Models.Invoice *@
@{
	ViewBag.Title = "Invoice Management";
	var theme = User.FindFirst("Theme")?.Value ?? "#198754";
}

<style>
	:root {
		--theme-color: @theme;
		--sidebar-width: 280px;
		--sidebar-collapsed-width: 70px;
		--transition-speed: 0.3s;
		--primary-color: @theme;
		--secondary-color: #6c757d;
		--light-bg: #f8f9fa;
	}

	.card-title i {
		color: var(--theme-color);
	}

	.nav-tabs .nav-link.active {
		background: var(--theme-color);
		color: #fff !important;
	}

	.btn-theme {
		background-color: var(--theme-color);
		border-color: var(--theme-color);
		color: white;
	}

		.btn-theme:hover {
			background-color: #166f46;
			border-color: #166f46;
		}

	.nav-tabs .nav-link {
		color: var(--theme-color);
		font-weight: 600;
		border: 2px solid transparent;
		border-radius: 0.5rem 0.5rem 0 0;
		transition: all 0.3s ease-in-out;
	}

		.nav-tabs .nav-link:hover {
			background: #e6f4ea;
			border-color: var(--theme-color);
			color: var(--theme-color);
		}

		.nav-tabs .nav-link.active {
			background: var(--theme-color);
			color: white !important;
			border-color: var(--theme-color);
		}

	.status-badge {
		padding: 0.5em 1em;
		border-radius: 20px;
		font-weight: 600;
	}

	.badge-paid {
		background-color: #d4edda;
		color: #155724;
		border: 1px solid #c3e6cb;
	}

	.badge-pending {
		background-color: #fff3cd;
		color: #856404;
		border: 1px solid #ffeaa7;
	}

	.badge-overdue {
		background-color: #f8d7da;
		color: #721c24;
		border: 1px solid #f5c6cb;
	}
</style>

<main class="dashboard-content with-sidebar collapsed">
	<div class="container-fluid mt-4">
		<ul class="nav nav-tabs" id="invoiceTabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="new-invoice-tab" data-bs-toggle="tab"
						data-bs-target="#new-invoice" type="button" role="tab">
					<i class="bi bi-file-earmark-plus"></i> New Invoice
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="all-invoices-tab" data-bs-toggle="tab"
						data-bs-target="#all-invoices" type="button" role="tab">
					<i class="bi bi-list-ul"></i> All Invoices
				</button>
			</li>
		</ul>

		<div class="tab-content border border-top-0 p-4" id="invoiceTabsContent">
			<!-- New Invoice Tab -->
			<div class="tab-pane fade show active" id="new-invoice" role="tabpanel">
				<form asp-action="CreateInvoice" method="post" id="invoiceForm">
					<div class="card p-3 mb-4 shadow-sm">
						<h5 class="card-title"><i class="bi bi-receipt"></i> Invoice Details</h5>
						<div class="row">
							<div class="col-md-4 mb-3">
								<label class="form-label">Invoice ID</label>
								<input class="form-control" value="INV-@DateTime.Now.ToString("yyyyMMdd")-001" readonly />
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Booking ID</label>
								<select class="form-select" required>
									<option value="">-- Select Booking --</option>
									<option>BKG-20241112-001 - Michael Scott</option>
									<option>BKG-20241110-002 - Pam Beesly</option>
									<option>BKG-20241108-003 - Jim Halpert</option>
								</select>
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Stage Name</label>
								<select class="form-select" required>
									<option value="">-- Select Stage --</option>
									<option value="token">Token Payment</option>
									<option value="agreement">Agreement Payment</option>
									<option value="construction">Construction Stage</option>
									<option value="possession">Possession Payment</option>
									<option value="registration">Registration Charges</option>
									<option value="maintenance">Maintenance Advance</option>
								</select>
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Due Amount (₹)</label>
								<input type="number" step="0.01" class="form-control" placeholder="Enter due amount" required />
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Due Date</label>
								<input type="date" class="form-control" required />
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Paid Date</label>
								<input type="date" class="form-control" />
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Payment Mode</label>
								<select class="form-select">
									<option value="">-- Select Payment Mode --</option>
									<option value="cash">Cash</option>
									<option value="upi">UPI</option>
									<option value="cheque">Cheque</option>
									<option value="bank_transfer">Bank Transfer</option>
									<option value="card">Credit/Debit Card</option>
								</select>
							</div>
							<div class="col-md-8 mb-3">
								<label class="form-label">Remarks / Notes</label>
								<textarea class="form-control" rows="3" placeholder="Add any additional notes or terms..."></textarea>
							</div>
						</div>
					</div>

					<!-- Booking Summary Card -->
					<div class="card p-3 mb-4 shadow-sm">
						<h5 class="card-title"><i class="bi bi-journal-text"></i> Booking Summary</h5>
						<div class="row">
							<div class="col-md-6">
								<div class="border rounded p-3 bg-light">
									<h6 class="text-theme">Customer Information</h6>
									<div class="small">
										<div><strong>Customer:</strong> <span id="summaryCustomer">-</span></div>
										<div><strong>Phone:</strong> <span id="summaryPhone">-</span></div>
										<div><strong>Email:</strong> <span id="summaryEmail">-</span></div>
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="border rounded p-3 bg-light">
									<h6 class="text-theme">Property Information</h6>
									<div class="small">
										<div><strong>Property:</strong> <span id="summaryProperty">-</span></div>
										<div><strong>Type:</strong> <span id="summaryType">-</span></div>
										<div><strong>Total Price:</strong> <span id="summaryPrice">-</span></div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="d-flex justify-content-end gap-2">
						<button type="reset" class="btn btn-secondary btn-lg">
							<i class="bi bi-x-circle"></i> Reset
						</button>
						<button type="submit" class="btn btn-theme btn-lg">
							<i class="bi bi-save"></i> Create Invoice
						</button>
					</div>
				</form>
			</div>

			<!-- All Invoices Tab -->
			<div class="tab-pane fade" id="all-invoices" role="tabpanel">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<div class="btn-group">
						<button class="btn btn-outline-theme active">All Invoices</button>
						<button class="btn btn-outline-theme">Paid</button>
						<button class="btn btn-outline-theme">Pending</button>
						<button class="btn btn-outline-theme">Overdue</button>
					</div>
					<div class="input-group" style="width: 300px;">
						<input type="text" class="form-control" placeholder="Search invoices...">
						<button class="btn btn-theme" type="button">
							<i class="bi bi-search"></i>
						</button>
					</div>
				</div>

				<table class="table table-striped table-hover mt-3">
					<thead class="table-primary">
						<tr>
							<th>Invoice ID</th>
							<th>Booking ID</th>
							<th>Customer</th>
							<th>Stage</th>
							<th>Due Amount</th>
							<th>Due Date</th>
							<th>Paid Date</th>
							<th>Status</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>INV-20241112-001</td>
							<td>BKG-20241112-001</td>
							<td>Michael Scott</td>
							<td>Token Payment</td>
							<td>₹5,00,000</td>
							<td>2024-11-20</td>
							<td>2024-11-12</td>
							<td><span class="status-badge badge-paid">Paid</span></td>
							<td>
								<button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
								<button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
							</td>
						</tr>
						<tr>
							<td>INV-20241110-001</td>
							<td>BKG-20241110-002</td>
							<td>Pam Beesly</td>
							<td>Agreement Payment</td>
							<td>₹10,00,000</td>
							<td>2024-11-25</td>
							<td>-</td>
							<td><span class="status-badge badge-pending">Pending</span></td>
							<td>
								<button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
								<button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
							</td>
						</tr>
						<tr>
							<td>INV-20241108-001</td>
							<td>BKG-20241108-003</td>
							<td>Jim Halpert</td>
							<td>Construction Stage</td>
							<td>₹15,00,000</td>
							<td>2024-11-15</td>
							<td>-</td>
							<td><span class="status-badge badge-overdue">Overdue</span></td>
							<td>
								<button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
								<button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
							</td>
						</tr>
						<tr>
							<td>INV-20241105-001</td>
							<td>BKG-20241105-004</td>
							<td>Dwight Schrute</td>
							<td>Possession Payment</td>
							<td>₹25,00,000</td>
							<td>2024-12-01</td>
							<td>-</td>
							<td><span class="status-badge badge-pending">Pending</span></td>
							<td>
								<button class="btn btn-sm btn-info"><i class="bi bi-eye"></i> View</button>
								<button class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i> Edit</button>
							</td>
						</tr>
					</tbody>
				</table>
				<div class="d-flex justify-content-between">
					<span class="text-muted">Showing 1 to 4 of 24 total invoices.</span>
					<button class="btn btn-outline-secondary">Load More</button>
				</div>
			</div>
		</div>
	</div>
</main>

@section Scripts {
		<script>
			document.addEventListener('DOMContentLoaded', function () {
				var triggerEl = document.querySelector('#invoiceTabs button[data-bs-target="#new-invoice"]');
				if (triggerEl) {
					bootstrap.Tab.getInstance(triggerEl)?.show();
				}

				// Sample data for booking information
				const bookingData = {
					'BKG-20241112-001': {
						customer: 'Michael Scott',
						phone: '+91 98765 43210',
						email: 'michael@dundermifflin.com',
						property: 'Ocean View Apartment',
						type: '3 BHK Apartment',
						price: '₹2.5 Cr'
					},
					'BKG-20241110-002': {
						customer: 'Pam Beesly',
						phone: '+91 87654 32109',
						email: 'pam@dundermifflin.com',
						property: 'Downtown Office',
						type: 'Commercial Office',
						price: '₹5 Cr'
					},
					'BKG-20241108-003': {
						customer: 'Jim Halpert',
						phone: '+91 76543 21098',
						email: 'jim@dundermifflin.com',
						property: 'Garden Villa',
						type: 'Villa',
						price: '₹1.8 Cr'
					}
				};

				// Update booking summary when booking is selected
				document.querySelector('select[name="BookingId"]').addEventListener('change', function() {
					const bookingId = this.value.split(' ')[0];
					const booking = bookingData[bookingId];
					if (booking) {
						document.getElementById('summaryCustomer').textContent = booking.customer;
						document.getElementById('summaryPhone').textContent = booking.phone;
						document.getElementById('summaryEmail').textContent = booking.email;
						document.getElementById('summaryProperty').textContent = booking.property;
						document.getElementById('summaryType').textContent = booking.type;
						document.getElementById('summaryPrice').textContent = booking.price;
					}
				});

				// Auto-set due date to 7 days from now
				const dueDateInput = document.querySelector('input[name="DueDate"]');
				if (dueDateInput) {
					const nextWeek = new Date();
					nextWeek.setDate(nextWeek.getDate() + 7);
					dueDateInput.value = nextWeek.toISOString().split('T')[0];
				}
			});
		</script>
}