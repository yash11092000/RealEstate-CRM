@model PhysioWeb.Models.PropertyMaster

@{
	ViewData["Title"] = "Properties";
}

@{
	var theme = User.FindFirst("Theme")?.Value ?? "#198754";
}
<style>
	:root {
		--primary-green: @theme;
		/* Derived from primary */
		--dark-green: color-mix(in srgb, var(--primary-green) 80%, black);
		--light-green: color-mix(in srgb, var(--primary-green) 80%, white);
		--light-gray: #f8f9fa;
		--medium-gray: #e9ecef;
		--dark-gray: #6c757d;
	}

	body {
		background-color: var(--light-gray);
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}

	.property-header {
		background-color: white;
		border-bottom: 1px solid var(--medium-gray);
		box-shadow: 0 2px 15px rgba(0,0,0,0.05);
	}

	.gallery-main {
		height: 350px;
		background-color: white;
		border-radius: 0.5rem;
		overflow: hidden;
		box-shadow: 0 4px 15px rgba(0,0,0,0.08);
	}

	@@media (min-width: 768px) {
		.gallery-main {
			height: 450px;
		}
	}

	.thumb-container {
		position: relative;
		width: 80px;
		height: 60px;
		overflow: hidden;
		border-radius: 0.4rem;
		cursor: pointer;
		flex-shrink: 0;
	}

	@@media (min-width: 576px) {
		.thumb-container {
			width: 100px;
			height: 75px;
		}
	}

	.gallery-thumb {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.video-thumb {
		background-color: #000;
		position: relative;
	}

		.video-thumb .thumbnail-preview {
			width: 100%;
			height: 100%;
			object-fit: cover;
			opacity: 0.8;
		}

		.video-thumb .bi-play-circle-fill {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: 1.5rem;
			color: rgba(255, 255, 255, 0.9);
		}

	.active-thumb {
		border: 3px solid var(--primary-green);
		box-sizing: border-box;
	}

	.detail-card {
		background-color: white;
		border-radius: 0.5rem;
		border: none;
		box-shadow: 0 2px 10px rgba(0,0,0,0.05);
		margin-bottom: 1.5rem;
	}

	.price-badge {
		background-color: var(--light-green);
		color: white;
		font-size: 1.1rem;
		font-weight: 600;
		padding: 0.5rem 1rem;
		border-radius: 50px;
	}

	.amenity-badge {
		background-color: var(--light-green);
		color: var(--dark-green);
		padding: 0.5rem 1rem;
		border-radius: 50px;
		font-size: 0.9rem;
		margin-bottom: 0.5rem;
		display: inline-block;
	}

	.btn-green {
		background-color: var(--primary-green);
		color: white;
		font-weight: 500;
		border-radius: 50px;
	}

	.btn-outline-green {
		border-color: var(--primary-green);
		color: var(--primary-green);
		font-weight: 500;
		border-radius: 50px;
	}

	.section-title {
		font-weight: 600;
		color: var(--dark-green);
		position: relative;
		padding-bottom: 0.5rem;
		margin-bottom: 1.5rem;
	}

		.section-title:after {
			content: '';
			position: absolute;
			left: 0;
			bottom: 0;
			width: 50px;
			height: 3px;
			background-color: var(--primary-green);
			border-radius: 3px;
		}

	.thumbnail-scroll {
		display: flex;
		gap: 0.8rem;
		overflow-x: auto;
		padding-bottom: 1rem;
		scrollbar-width: thin;
		scrollbar-color: var(--primary-green) var(--medium-gray);
	}

		.thumbnail-scroll::-webkit-scrollbar {
			height: 6px;
		}

		.thumbnail-scroll::-webkit-scrollbar-track {
			background: var(--medium-gray);
			border-radius: 10px;
		}

		.thumbnail-scroll::-webkit-scrollbar-thumb {
			background-color: var(--primary-green);
			border-radius: 10px;
		}

	.contact-form .form-control {
		border-radius: 0.5rem;
		padding: 0.8rem 1rem;
	}

	.social-share-btn {
		width: 45px;
		height: 45px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 50%;
	}

	.property-highlight {
		background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(33, 136, 56, 0.1) 100%);
		border-left: 4px solid var(--primary-green);
		padding: 1.5rem;
		border-radius: 0 0.5rem 0.5rem 0;
		margin: 1.5rem 0;
	}

	.feature-icon {
		width: 50px;
		height: 50px;
		background-color: var(--light-green);
		border-radius: 0.75rem;
		display: flex;
		align-items: center;
		justify-content: center;
		color: white;
		font-size: 1.5rem;
		margin-right: 1rem;
	}

	.detail-item {
		padding: 0.8rem 0;
		border-bottom: 1px solid var(--medium-gray);
	}

	.detail-label {
		color: var(--dark-gray);
		font-weight: 500;
	}

	.detail-value {
		font-weight: 600;
	}

	/* Responsive adjustments */
	@@media (max-width: 767.98px) {
		.property-header {
			padding: 1rem 0;
		}

		.price-badge {
			font-size: 1rem;
			padding: 0.4rem 0.8rem;
		}

		.gallery-main {
			height: 300px;
		}

		.feature-icon {
			width: 40px;
			height: 40px;
			font-size: 1.2rem;
			margin-right: 0.75rem;
		}
	}

	@@media (max-width: 575.98px) {
		.gallery-main {
			height: 250px;
		}

		.section-title {
			font-size: 1.25rem;
		}
	}

	.detail-card {
		background: white;
		border-radius: 8px;
		box-shadow: 0 2px 10px rgba(0,0,0,0.05);
		padding: 25px;
		max-width: 1200px;
		margin: 0 auto;
	}

	.section-title {
		font-weight: 600;
		color: #2c3e50;
		margin-bottom: 25px;
		padding-bottom: 10px;
		border-bottom: 1px solid #eaeaea;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.admin-toggle {
		display: flex;
		align-items: center;
		gap: 10px;
		font-size: 0.9rem;
	}

	.switch {
		position: relative;
		display: inline-block;
		width: 50px;
		height: 24px;
	}

		.switch input {
			opacity: 0;
			width: 0;
			height: 0;
		}

	.slider {
		position: absolute;
		cursor: pointer;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: #ccc;
		transition: .4s;
		border-radius: 24px;
	}

		.slider:before {
			position: absolute;
			content: "";
			height: 16px;
			width: 16px;
			left: 4px;
			bottom: 4px;
			background-color: white;
			transition: .4s;
			border-radius: 50%;
		}

	input:checked + .slider {
		background-color: var(--primary-green);
	}

		input:checked + .slider:before {
			transform: translateX(26px);
		}

	.detail-row {
		display: flex;
		margin-bottom: 8px;
		padding: 5px 0;
	}

	.detail-heading {
		font-weight: 500;
		color: #555;
		width: 25%;
		padding-right: 15px;
	}

	.detail-value {
		font-weight: 400;
		color: #222;
		width: 25%;
	}

	.admin-only {
		background-color: #f8f9fa;
		border-left: 3px solid var(--primary-green);
		padding-left: 5px;
	}

	.hidden {
		display: none;
	}

	/* Responsive adjustments */
	@@media (max-width: 992px) {
		.detail-row {
			flex-wrap: wrap;
		}

		.detail-heading, .detail-value {
			width: 50%;
			margin-bottom: 5px;
		}
	}

	@@media (max-width: 576px) {
		.detail-heading, .detail-value {
			width: 100%;
		}

		.detail-card {
			padding: 15px;
		}

		.section-title {
			flex-direction: column;
			align-items: flex-start;
			gap: 10px;
		}
	}
	/* newly added */

	.ratio-9x16 {
		--bs-aspect-ratio: calc(16 / 9 * 100%); /* 177.77% */
	}

</style>

<!-- Property Header -->
<div class="property-header py-3 py-md-4">
	<div class="container-fluid">
		<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
			<div class="mb-3 mb-md-0">
				<h1 class="h4 h3-md mb-1 fw-bold">@Model.Title <span class="badge price-badge">@Model.PropertyType</span></h1>
				<p class="text-muted mb-0">
					<i class="bi bi-geo-alt-fill me-1"></i>
					<span class="text-dark">@(Model.Address == "" ? "Location Not Found" : Model.Address)</span>
				</p>
				<p class="text-muted mb-0">
					<i class="bi bi-pin-map-fill me-1"></i>
					<span class="text-dark">@(Model.Landmark == "" ? "LandMark Not Found" : Model.Landmark)</span>
				</p>
			</div>
			<div class="d-flex align-items-center gap-3">
				<span class="badge price-badge">
					₹@Model.DisplayMinPrice - ₹@Model.DisplayMaxPrice
				</span>
				<button class="btn btn-green btn-sm" data-bs-toggle="modal" data-bs-target="#shareModal">
					<i class="bi bi-share-fill me-1 me-md-2"></i>
					<span class="d-none d-md-inline">Share</span>
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Main Content -->
<div class="container-fluid my-3 my-md-4">
	<div class="row">
		<!-- Gallery Column -->
		<div class="col-lg-8">
			<!-- Main Image -->
			<div class="gallery-main mb-3">
				<img src="/secure-images/@Model.Images[0].Value" class="w-100 h-100" style="object-fit:contain;" id="mainImage" alt="Property image">
			</div>

			<!-- Thumbnails -->
			<div class="thumbnail-scroll mb-4">
				@for (int i = 0; i < Model.Images.Count; i++)
				{
					string activeClass = i == 0 ? "active-thumb" : "";
					<div class="thumb-container @activeClass" onclick="changeMainImage('/secure-images/@Model.Images[i].Value', this)">
						<img src="/secure-images/@Model.Images[i].Value" class="gallery-thumb" alt="Thumbnail @(i+1)">
					</div>
				}
				@for (int i = 0; i < Model.Videos.Count; i++)
				{
					<div class="thumb-container video-thumb"
						 onclick="openVideoModal('@Url.Content("~/secure-images/" + Model.Videos[i].Value)')">
						<video class="thumbnail-preview" muted loop>
							<source src="@Url.Content("~/secure-images/" + Model.Videos[i].Value)" type="video/mp4">
						</video>
						<i class="bi bi-play-circle-fill"></i>
					</div>
				}
			</div>

			<!-- Property Highlights -->
			<div class="property-highlight">
				<div class="row">
					<div class="col-6 col-md-4 mb-3 mb-md-0">
						<div class="feature-item">
							<div class="feature-icon">
								<i class="bi bi-house-door"></i>
							</div>
							<div>
								<div class="h5 mb-0">@Model.PropertyType</div>
								<small class="text-muted">Property Type</small>
							</div>
						</div>
					</div>
					<div class="col-6 col-md-4 mb-3 mb-md-0">
						<div class="feature-item">
							<div class="feature-icon">
								<i class="bi bi-arrows-angle-expand"></i>
							</div>
							<div>
								<div class="h5 mb-0">@Model.CarpetArea sq.ft</div>
								<small class="text-muted">Built Up Area</small>
							</div>
						</div>
					</div>
					<div class="col-6 col-md-4">
						<div class="feature-item">
							<div class="feature-icon">
								<i class="bi bi-door-open"></i>
							</div>
							<div>
								<div class="h5 mb-0">@Model.Bedrooms</div>
								<small class="text-muted">Bedrooms</small>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="detail-card">
				<h3 class="section-title">
					Property Details
				</h3>

				<!-- Row 1 -->
				<div class="detail-row">
					<div class="detail-heading">Property Type:</div>
					<div class="detail-value">@Model.PropertyType</div>
					<div class="detail-heading">Built Up Area:</div>
					<div class="detail-value">@Model.CarpetArea sq.ft</div>
				</div>

				<!-- Row 2 -->
				<div class="detail-row">
					<div class="detail-heading">Bedrooms:</div>
					<div class="detail-value">@Model.Bedrooms</div>
					<div class="detail-heading">Bathrooms:</div>
					<div class="detail-value">@Model.Bathrooms</div>
				</div>

				<!-- Row 3 -->
				<div class="detail-row">
					<div class="detail-heading">Country:</div>
					<div class="detail-value">@Model.Country</div>
					<div class="detail-heading">State:</div>
					<div class="detail-value">@Model.State</div>
				</div>

				<!-- Row 4 -->
				<div class="detail-row">
					<div class="detail-heading">City:</div>
					<div class="detail-value">@Model.City</div>
					<div class="detail-heading">Pincode:</div>
					<div class="detail-value">@Model.PinCode</div>
				</div>

				<!-- Row 5 -->
				<div class="detail-row">
					<div class="detail-heading">Furnishing Status:</div>
					<div class="detail-value">@Model.FurnishingStatus</div>
					<div class="detail-heading">Area:</div>
					<div class="detail-value">@Model.Area</div>
				</div>

				<!-- Row 6 -->
				<div class="detail-row">
					<div class="detail-heading">Total Floor:</div>
					<div class="detail-value">@Model.TotalFloorBuilding</div>
					<div class="detail-heading">Sub Area:</div>
					<div class="detail-value">@Model.SubArea</div>
				</div>

				<!-- Row 7 -->
				<div class="detail-row">
					<div class="detail-heading">Floor:</div>
					<div class="detail-value">@Model.Floor</div>
					<div class="detail-heading">Year Of Construction:</div>
					<div class="detail-value">@Model.YearOfConstruction</div>
				</div>

				<!-- Row 8 -->
				<div class="detail-row">
					<div class="detail-heading">Buyer Type:</div>
					<div class="detail-value">@Model.PreferedBuyerType</div>
					<div class="detail-heading">Vastu:</div>
					<div class="detail-value">@Model.Vastu</div>
				</div>

				<!-- Row 9 -->
				<div class="detail-row">
					<div class="detail-heading">Property Category:</div>
					<div class="detail-value">@Model.PropertyCategory</div>
					<div class="detail-heading"></div>
					<div class="detail-value"></div>
				</div>

				<!-- Admin-only rows (hidden by default) -->
				@if (User.IsInRole("Agency"))
				{
					<div id="adminRows">
						<!-- Row 10 -->
						<div class="detail-row admin-only">
							<div class="detail-heading">Contact Person Name:</div>
							<div class="detail-value">@Model.ContactPersonName</div>
							<div class="detail-heading">Contact Person No:</div>
							<div class="detail-value">@Model.ContactPersonPhone</div>
						</div>

						<!-- Row 11 -->
						<div class="detail-row admin-only">
							<div class="detail-heading">Contact Person Alternate No:</div>
							<div class="detail-value">@Model.ContactPersonAlternatePhone</div>
							<div class="detail-heading"></div>
							<div class="detail-value"></div>
						</div>
					</div>
				}
			</div>

			<!-- Description -->
			<div class="detail-card p-3 p-md-4">
				<h3 class="section-title">Description</h3>
				<div class="description-content" style="line-height: 1.8;">
					@Html.Raw(Model.Description.Replace("\n", "<br>"))
				</div>
			</div>

			<!-- Amenities -->
			<div class="detail-card p-3 p-md-4">
				<h3 class="section-title">Amenities</h3>
				<div class="d-flex flex-wrap gap-2">
					@for (int j = 0; j < Model.AmenityList.Count; j++)
					{
						<span class="amenity-badge">
							<i class="bi bi-check-circle me-1"></i> @Model.AmenityList[j].Text
						</span>
					}
				</div>
			</div>

			<!-- Floor Plans -->
			<div class="detail-card p-3 p-md-4">
				<h3 class="section-title">Floor Plans</h3>
				<div class="text-center">
					<img src="https://via.placeholder.com/800x600?text=Floor+Plan" alt="Floor Plan" class="img-fluid rounded mb-3">
					<div class="d-flex flex-column flex-sm-row justify-content-center gap-3">
						<button class="btn btn-outline-green mb-2 mb-sm-0">
							<i class="bi bi-download me-2"></i> Download PDF
						</button>
						<button class="btn btn-green">
							<i class="bi bi-printer me-2"></i> Print Plan
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Sidebar Column -->
		<div class="col-lg-4">
			<!-- Contact Form -->
			<div class="detail-card p-3 p-md-4" style="top:5rem;">
				<h3 class="section-title">Schedule a Viewing</h3>
				<form class="contact-form">
					<div class="mb-3">
						<label class="form-label">Your Name</label>
						<input type="text" class="form-control" id="ContactPersonName" placeholder="Enter your name" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Email Address</label>
						<input type="email" class="form-control" id="ContactPersonEmail" placeholder="Enter your email" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Phone Number</label>
						<input type="tel" class="form-control" id="ContactPersonPhone" placeholder="Enter your phone" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Message</label>
						<textarea class="form-control" rows="3" id="ContactPersonDescription" placeholder="Any specific requirements?"></textarea>
					</div>
					<button type="button" id="SendRequest" class="btn btn-green w-100 py-2">
						<i class="bi bi-calendar-check me-2"></i> Request Viewing
					</button>
				</form>
				<div class="text-center mt-3">
					<p class="text-muted small mb-1">Or call us directly at</p>
					<a href="tel:+919876543210" class="text-success fw-bold">+91 9820753830</a><br />
					<a href="tel:+919876543210" class="text-success fw-bold">+91 7506080089</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Video Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" style="max-width:360px">
		<div class="modal-content border-0 rounded-4 shadow-lg p-0" style="background: transparent;">
			<div class="modal-body p-0 position-relative">

				<!-- Cancel / Close Button -->
				<button type="button"
						class="btn-close btn-close-white position-absolute top-0 end-0 m-2"
						data-bs-dismiss="modal"
						aria-label="Close" style="z-index: 9999 !important;"></button>

				<!-- Video container -->
				<div style="aspect-ratio:9/16; width:100%; background:black; border-radius: 1.5rem; overflow:hidden;">
					<video id="propertyVideo" controls autoplay class="w-100 h-100" style="object-fit:cover;">
						<source src="your-video.mp4" type="video/mp4">
					</video>
				</div>
			</div>
		</div>
	</div>
</div>


<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header bg-success text-white">
				<h5 class="modal-title">Share This Property</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="mb-4">
					<label class="form-label fw-bold mb-3">Copy this link:</label>
					<div class="input-group">
						<input type="text" class="form-control" id="shareUrl" readonly>
						<button class="btn btn-success" onclick="copyToClipboard()">
							<i class="bi bi-clipboard me-2"></i> Copy
						</button>
					</div>
				</div>
				<div class="text-center">
					<p class="mb-3 fw-bold">Share via social media</p>
					<div class="d-flex justify-content-center gap-3">
						<a href="#" class="social-share-btn bg-primary text-white" id="facebookShare">
							<i class="bi bi-facebook"></i>
						</a>
						<a href="#" class="social-share-btn bg-info text-white" id="twitterShare">
							<i class="bi bi-twitter"></i>
						</a>
						<a href="#" class="social-share-btn bg-success text-white" id="whatsappShare">
							<i class="bi bi-whatsapp"></i>
						</a>
						<a href="#" class="social-share-btn bg-danger text-white" id="emailShare">
							<i class="bi bi-envelope"></i>
						</a>
					</div>
				</div>
			</div>
			<div class="modal-footer border-0">
				<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		// Change main image when thumbnail is clicked
		function changeMainImage(src, element) {
			document.getElementById('mainImage').src = src;

			// Remove active class from all thumbnails
			document.querySelectorAll('.thumb-container').forEach(thumb => {
				thumb.classList.remove('active-thumb');
			});

			// Add active class to clicked thumbnail
			element.classList.add('active-thumb');
		}

		// Open video modal
		function openVideoModal(videoSrc) {
			const modal = new bootstrap.Modal(document.getElementById('videoModal'));
			const videoElement = document.getElementById('propertyVideo');

			// Set video source
			videoElement.src = videoSrc;

			// Show modal
			modal.show();

			// Play video when modal is shown
			modal._element.addEventListener('shown.bs.modal', function () {
				videoElement.play();
			});

			// Pause video when modal is hidden
			modal._element.addEventListener('hidden.bs.modal', function () {
				videoElement.pause();
			});
		}

		// Initialize share modal with current URL
		document.addEventListener('DOMContentLoaded', function() {
			const shareModal = document.getElementById('shareModal');
			if (shareModal) {
				shareModal.addEventListener('show.bs.modal', function() {
					const currentUrl = window.location.href;
					document.getElementById('shareUrl').value = currentUrl;

					// Set social share links
					document.getElementById('facebookShare').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`;
					document.getElementById('twitterShare').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(currentUrl)}&text=Check%20this%20property`;
					document.getElementById('whatsappShare').href = `https://wa.me/?text=${encodeURIComponent('Check this property: ' + currentUrl)}`;
					document.getElementById('emailShare').href = `mailto:?subject=Property%20Listing&body=${encodeURIComponent('Check this property: ' + currentUrl)}`;
				});
			}
		});

		// Copy to clipboard function
		function copyToClipboard() {
			const shareUrl = document.getElementById('shareUrl');
			shareUrl.select();
			shareUrl.setSelectionRange(0, 99999);
			document.execCommand('copy');

			// Show feedback
			const copyBtn = document.querySelector('#shareModal .btn-success');
			const originalText = copyBtn.innerHTML;
			copyBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i> Copied!';

			setTimeout(() => {
				copyBtn.innerHTML = originalText;
			}, 2000);
		}

		$("#SendRequest").on("click",function(){
			var ContactPersonName = $("#ContactPersonName");
			var ContactPersonEmail = $("#ContactPersonEmail");
			var ContactPersonPhone = $("#ContactPersonPhone");
			var ContactPersonDescription = $("#ContactPersonDescription");

			if(ContactPersonName.val() == ""){
				notyf.error("Enter Name");
				ContactPersonName.focus();
			}
			else if(ContactPersonEmail.val() == ""){
				notyf.error("Enter Name");
				ContactPersonEmail.focus();
			}
			else if(ContactPersonPhone.val() == ""){
				notyf.error("Enter Name");
				ContactPersonPhone.focus();
			}
			else {
				 $.ajax({
				url: "/PropertyDetails/SendRequest",  // 🔹 Change this to your endpoint
				type: "POST",
				contentType: "application/json; charset=utf-8",
				data: JSON.stringify(data),
				success: function (response) {
					alert("Your request has been submitted successfully!");
					$(".contact-form")[0].reset(); // reset form
				},
				error: function (xhr, status, error) {
					console.error("Error: " + error);
					alert("Something went wrong. Please try again.");
				}
			});
			}
		})
	</script>
}