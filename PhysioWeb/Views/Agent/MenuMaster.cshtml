@model PhysioWeb.Models.SidebarMenu

@{
	ViewBag.Title = "Agency Dashboard";
	var theme = User.FindFirst("Theme")?.Value ?? "#198754";
}

<style>
	:root {
		--theme-color: @theme;
		--sidebar-width: 280px;
		--sidebar-collapsed-width: 70px;
		--transition-speed: 0.3s;
		--primary-color: @theme;
		--secondary-color: #6c757d;
		--light-bg: #f8f9fa;
	}
	/* form */
	.form-container {
		background: white;
		border-radius: 12px;
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
		overflow: hidden;
	}

	.form-header {
		background: linear-gradient(135deg, var(--primary-color), #157347);
		color: white;
		padding: 2rem;
	}

	.form-body {
		padding: 2rem;
	}

	.form-section {
		background: var(--light-bg);
		border-radius: 8px;
		padding: 1.5rem;
		margin-bottom: 1.5rem;
		border-left: 4px solid var(--primary-color);
	}

		.form-section h6 {
			color: var(--primary-color);
			margin-bottom: 1rem;
			font-weight: 600;
		}

	.icon-preview-container {
		background: white;
		border: 2px dashed #dee2e6;
		border-radius: 8px;
		padding: 1.5rem;
		text-align: center;
		transition: all 0.3s ease;
	}

		.icon-preview-container:hover {
			border-color: var(--primary-color);
		}

	.icon-display {
		width: 60px;
		height: 60px;
		background: var(--primary-color);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto 1rem;
		color: white;
		font-size: 1.5rem;
	}

	.form-control:focus, .form-select:focus {
		border-color: var(--primary-color);
		box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
	}

	.btn-primary {
		background: var(--primary-color);
		border-color: var(--primary-color);
		padding: 0.75rem 2rem;
		font-weight: 600;
	}

		.btn-primary:hover {
			background: #157347;
			border-color: #146c43;
		}

	.required-label::after {
		content: " *";
		color: #dc3545;
	}

	.info-text {
		font-size: 0.875rem;
		color: var(--secondary-color);
	}

	.menu-type-badge {
		background: var(--primary-color);
		color: white;
		padding: 0.25rem 0.75rem;
		border-radius: 20px;
		font-size: 0.75rem;
		font-weight: 500;
	}

	.feature-card {
		background: white;
		border: 1px solid #e9ecef;
		border-radius: 8px;
		padding: 1rem;
		text-align: center;
		transition: transform 0.2s ease;
	}

		.feature-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}

	.feature-icon {
		width: 50px;
		height: 50px;
		background: var(--light-bg);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto 0.5rem;
		color: var(--primary-color);
		font-size: 1.25rem;
	}

	.nav-tabs .nav-link {
		color: var(--theme-color); /* Bootstrap success green */
		font-weight: 600;
		border: 2px solid transparent;
		border-radius: 0.5rem 0.5rem 0 0;
		transition: all 0.3s ease-in-out;
	}

		.nav-tabs .nav-link:hover {
			background: #e6f4ea; /* light green hover */
			border-color: var(--theme-color);
			color: var(--theme-color);
		}

		.nav-tabs .nav-link.active {
			background: var(--theme-color);
			color: white !important;
			border-color: var(--theme-color);
		}
</style>

<!-- Main Content -->
<main class="dashboard-content with-sidebar collapsed">


	<div class="container-fluid py-5">
		<ul class="nav nav-tabs mb-3 mt-1" id="agencyMainTabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#formSection" type="button" role="tab">
					📝 Add/Edit Menu
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#listSection" type="button" role="tab">
					📋 Menu List
				</button>
			</li>
		</ul>

		<div class="tab-content">
			<div class="tab-pane fade show active" id="formSection" role="tabpanel">
				<div class="row justify-content-center">
					<div class="col-lg-12">
						<!-- Main Form -->
						<div class="form-container">
							<!-- Form Body -->
							<div class="form-body">
								<form id="menuForm">
									<input type="hidden" id="MenuId" name="MenuId" />
									<div class="row">
										<!-- Basic Information -->
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Menu Name<span class="impMark">*</span></label>
											<input type="text" class="form-control" id="MenuName" name="MenuName" placeholder="Enter menu name" />
										</div>
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Menu URL<span class="impMark">*</span></label>
											<input type="text" class="form-control" id="MenuUrl" name="MenuUrl" placeholder="/page/url" />
										</div>

										<!-- Menu Type and Parent -->
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Menu Type<span class="impMark">*</span></label>
											<select class="form-control" id="MenuType" name="MenuType">
												<option value="">Select Type</option>
												<option value="0">Parent Menu</option>
												<option value="1">Child Menu</option>
											</select>
										</div>
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Parent Menu</label>
											<select class="form-control" id="ParentMenuId" name="ParentMenuId">
												<option value="">-- Select Parent Menu --</option>
												@for (int i = 0; i < Model.ParentList.Count; i++)
												{
													<option value="@Model.ParentList[i].Value">@Model.ParentList[i].Text</option>
												}
											</select>
										</div>

										<!-- Icon and Display Order -->
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Icon Class<span class="impMark">*</span></label>
											<div class="input-group">
												<span class="input-group-text">bi</span>
												<input type="text" class="form-control" id="MenuIcon" name="MenuIcon" placeholder="house" />
											</div>
											<small class="form-text text-muted">Bootstrap Icon name (without 'bi-' prefix)</small>
										</div>
										<div class="col-md-6 mb-3">
											<label class="form-label fw-bold">Display Order</label>
											<input type="number" class="form-control" id="DisplayOrder" name="DisplayOrder" value="0" min="0" />
										</div>

										<!-- Icon Preview -->
										<div class="col-md-12 mb-3">
											<label class="form-label fw-bold">Icon Preview</label>
											<div class="border rounded p-3 text-center bg-light">
												<div class="mb-2">
													<i class="bi bi-house fs-1 text-primary" id="IconPreview"></i>
												</div>
												<small class="text-muted" id="PreviewText">This is how your icon will appear</small>
											</div>
										</div>

										<!-- Settings -->
										<div class="col-md-6 mb-3">
											<div class="form-check">
												<input class="form-check-input" type="checkbox" id="IsActive" name="IsActive" checked />
												<label class="form-check-label fw-bold">Active Menu</label>
											</div>
										</div>
										<div class="col-md-6 mb-3">
											<div class="form-check">
												<input class="form-check-input" type="checkbox" id="OpenInNewTab" name="OpenInNewTab" />
												<label class="form-check-label fw-bold">Open in New Tab</label>
											</div>
										</div>
										<div class="col-md-12 text-lg-end">
											<button class="btn btn-success" id="AddSideBar">Submit</button>
										</div>
									</div>
								</form>

							</div>
						</div>


					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="listSection" role="tabpanel">
				hi
			</div>
		</div>
	</div>
</main>

@section Scripts {
	<script>
		// // Simple form interactivity
		// document.addEventListener('DOMContentLoaded', function() {
		// 	const menuTypeSelect = document.querySelector('select[required]');
		// 	const parentMenuSelect = document.querySelector('select[disabled]');
		// 	const iconInput = document.querySelector('input[placeholder="house"]');
		// 	const iconDisplay = document.querySelector('.icon-display i');

		// 	// Menu type change handler
		// 	menuTypeSelect.addEventListener('change', function() {
		// 		parentMenuSelect.disabled = this.value !== 'child';
		// 	});

		// 	// Icon preview handler
		// 	iconInput.addEventListener('input', function() {
		// 		const iconClass = this.value ? 'bi-' + this.value : 'bi-house';
		// 		iconDisplay.className = iconClass;
		// 	});

		// 	// Form submission handler
		// 	document.getElementById('menuForm').addEventListener('submit', function(e) {
		// 		e.preventDefault();
		// 		alert('Menu item saved successfully!');
		// 		this.reset();
		// 		iconDisplay.className = 'bi-house';
		// 	});
		// });
			// Live icon preview
		$("#MenuIcon").on("input", function () {
			let iconName = $(this).val().trim();
			$("#IconPreview").attr("class", `bi bi-${iconName} fs-1 text-primary`);
		});

		// Enable/disable parent dropdown based on menu type
		$("#MenuType").on("change", function () {
			if ($(this).val() === "1") {
				$("#ParentMenuId").prop("disabled", false);
			} else {
				$("#ParentMenuId").prop("disabled", true).val("");
			}
		});
		   $('#AddSideBar').on('click', function (e) {
			e.preventDefault();

			// Manual validation using Notyf only
			const menuName = $('#MenuName').val();
			const menuUrl = $('#MenuUrl').val();
			const menuType = $('#MenuType').val();
			const menuIcon = $('#MenuIcon').val();

			if (!menuName) return notyf.error('Please enter Menu Name');
			if (!menuUrl) return notyf.error('Please enter Menu URL');
			if (!menuType) return notyf.error('Please select Menu Type');
			if (!menuIcon) return notyf.error('Please enter Menu Icon');

			// Serialize form data
			const formData = $("#menuForm").serialize();

			$.ajax({
				url: '/Agent/SaveMenuMaster', // your endpoint
				type: 'POST',
				data: formData,
				beforeSend: function () {
					notyf.dismissAll();
				},
				success: function (response) {
					if (response) {
						notyf.success('Menu saved successfully!');
						$('#menuForm')[0].reset();
						$('#IconPreview').attr('class', 'bi bi-house fs-1 text-primary');
						$('#ParentMenuId').val('').prop('disabled', true);
					} else {
						notyf.error(response.message || 'Something went wrong.');
					}
				},
				error: function () {
					notyf.error('Server error occurred. Please try again.');
				}
			});
		});
	</script>
}